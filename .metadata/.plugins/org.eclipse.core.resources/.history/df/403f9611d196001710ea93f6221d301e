package agent;

import java.io.FileOutputStream;

import org.apache.mina.core.buffer.IoBuffer;
import org.apache.mina.core.filterchain.IoFilterAdapter;
import org.apache.mina.core.session.IoSession;

public class FileCacheFilter extends IoFilterAdapter{
	LogFile temp;
	
	public FileCacheFilter(LogFile temp) {
		this.temp = temp;
	}

	@Override
	public void messageReceived(NextFilter nextFilter, IoSession session, Object message) throws Exception {
		if(message instanceof IoBuffer){
			FileOutputStream fos = null;
			IoBuffer buffer = (IoBuffer) message;
			System.out.println(buffer.remaining());
			if(buffer.remaining() > 0){
				byte[] bytes = new byte[buffer.remaining()];
				try {
					fos = new FileOutputStream(temp.getTempFile(), true);
					buffer.get(bytes);
					fos.write(bytes);
				}finally {
					if(fos != null){
						fos.close();
					}
				}
			}else{
				nextFilter.messageReceived(session, temp);
			}
		}
	}
	
}
