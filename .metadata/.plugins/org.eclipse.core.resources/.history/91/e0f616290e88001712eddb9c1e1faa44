package adri.logviewer.agent.server;

import java.io.File;
import java.io.FileOutputStream;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import org.junit.Test;

import adri.logviewer.agent.file.LogFile;

public class ClientAgentTest {

	@Test
	public void testClient() throws Exception{
		MinaClient client = new MinaClient();
//		Object resultat = client.connect("localhost", 2008, "A://eclipse/logs");
//		if(resultat instanceof ArrayList<?>){
//			System.out.println(((ArrayList<?>)resultat).size());
//			resultat.toString();
//		}
		Object detail = client.connect("localhost", 2008, "A://eclipse/logs/app-2017-07-18.log");
		if(detail != null){
			System.out.println(detail instanceof List<?>);
			System.out.println(((List<?>)detail).size());
			LogFile f = ((List<LogFile>) detail).get(0);
			FileWriter fos = null;
			char[] bytesArray = new char[(int) f.getFile().length];
			try{
				File temp = new File("A://" + f.getFilename());
				fos = new FileWriter(temp);
				fos.write(bytesArray);
				System.out.println(bytesArray);
				System.out.println("Fichier copié");
			}catch(IOException e){
				throw e;
			}finally{
				if(fos != null){
					fos.close();
				}
			}
		}
		client.dispose();
	}

}
