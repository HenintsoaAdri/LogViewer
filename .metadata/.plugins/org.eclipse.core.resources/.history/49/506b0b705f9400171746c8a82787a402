<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
   "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
   "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>
   <constant name="struts.devMode" value="true" />
   <constant name="struts.enable.SlashesInActionNames" value="true"/>
   <package name="logViewer" extends="struts-default">
       
     <interceptors>
     	<interceptor name="loginInterceptor" class="adri.logviewer.interceptor.LoginInterceptor" />
     	<interceptor name="permissionInterceptor" class="adri.logviewer.interceptor.PermissionInterceptor" />
     	<interceptor name="filePermissionInterceptor" class="adri.logviewer.interceptor.FilePermissionInterceptor" />
        <interceptor-stack name="defaultStack">
            <interceptor-ref name="exception"/>
            <interceptor-ref name="alias"/>
            <interceptor-ref name="servletConfig"/>
            <interceptor-ref name="i18n"/>
            <interceptor-ref name="prepare"/>
            <interceptor-ref name="chain"/>
            <interceptor-ref name="scopedModelDriven"/>
            <interceptor-ref name="modelDriven"/>
            <interceptor-ref name="fileUpload"/>
            <interceptor-ref name="checkbox"/>
            <interceptor-ref name="datetime"/>
            <interceptor-ref name="multiselect"/>
            <interceptor-ref name="staticParams"/>
            <interceptor-ref name="actionMappingParams"/>
            <interceptor-ref name="params"/>
            <interceptor-ref name="conversionError"/>
	        <interceptor-ref name="validation">
			    <param name="excludeMethods">delete,find,edit,findAllPaginate,findAll,selectEntities,search</param>
			</interceptor-ref>
            <interceptor-ref name="workflow"/>
            <interceptor-ref name="debugging"/>
        </interceptor-stack>
     	<interceptor-stack name="loginStack">
     		<interceptor-ref name="loginInterceptor"/>
     		<interceptor-ref name="defaultStack"/>
     	</interceptor-stack>
     	<interceptor-stack name="crudStack">
     		<interceptor-ref name="loginStack"/>
     		<interceptor-ref name="permissionInterceptor"/>
     	</interceptor-stack>
     	<interceptor-stack name="fileStack">
     		<interceptor-ref name="loginStack"/>
     		<interceptor-ref name="filePermissionInterceptor"/>
     	</interceptor-stack>
     </interceptors>
     
     <default-action-ref name="index"/>
     
     <global-results>
         <result name="login" type="redirectAction">Connexion</result>
         <result name="permission">/includes/NotAllowed.jsp</result>
         <result name="file">/Fichiers/Parsed.jsp</result>
     </global-results>
     <global-exception-mappings>
     	<exception-mapping exception="java.lang.NullPointerException" result="NONE" />
     	<exception-mapping exception="adri.logviewer.exception.PermissionException" result="permission" />
     </global-exception-mappings>
     
     <action name="index" 
            class="adri.logviewer.action.BaseAction" 
            method="start">
        <result name="success">/index.jsp</result>
        <result name="error">/login.jsp</result>
     </action>
     <action name="Connexion" 
            class="adri.logviewer.action.UtilisateurAction" 
            method="login">
        <exception-mapping result="error" exception="adri.logviewer.exception.InputException"/>
		<result name="success" type="redirectAction">index</result>
		<result name="error">/login.jsp</result>
     </action>
     <action name="Deconnexion" 
            class="adri.logviewer.action.UtilisateurAction" 
            method="logout">
	     <result name="success" type="redirectAction">index</result>
	     <result name="error" type="redirectAction">index</result>
     </action>
     
     <!-- ************************
     	**********CRUD***********
      **************************** -->
                 
     <action name="*" 
            class="adri.logviewer.action.CrudAction" 
            method="findAllPaginate">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}View</param>
         <result name="success">/{1}/list.jsp</result>
         <result name="error" type="redirectAction">index</result>
     </action>
     <action name="*/new" 
            class="adri.logviewer.action.CrudAction" 
            method="selectEntities">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <result name="success">/{1}/create.jsp</result>
         <result name="input">/{1}/create.jsp</result>
         <result name="error" type="redirectAction">{1}</result>
     </action>
     <action name="*/save" 
            class="adri.logviewer.action.CrudAction" 
            method="save">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <result name="success" type="redirectAction">{1}/${item.id}</result>
         <result name="error">/{1}/create.jsp</result>
         <result name="input">/{1}/create.jsp</result>
         <result name="none" type="redirectAction">{1}</result>
     </action>
     <action name="*/edit/*" 
            class="adri.logviewer.action.CrudAction" 
            method="edit">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <param name="item.id">{2}</param>
         <result name="success">/{1}/edit.jsp</result>
         <result name="user" type="redirectAction">MesInformations/edit/</result>
         <result name="error" type="redirectAction">{1}</result>
     </action>
     <action name="*/update" 
            class="adri.logviewer.action.CrudAction" 
            method="update">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <result name="success" type="redirectAction">{1}/${item.id}</result>
         <result name="error">/{1}/edit.jsp</result>
         <result name="input">/{1}/edit.jsp</result>
         <result name="none" type="redirectAction">{1}</result>
     </action>
     <action name="*/delete/*"
            class="adri.logviewer.action.CrudAction" 
            method="delete">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <param name="item.id">{2}</param>
         <result name="success" type="redirectAction">{1}</result>
         <result name="error" type="chain">{1}/${item.id}</result>
         <result name="input" type="chain">{1}/${item.id}</result>
         <result name="none" type="redirectAction">{1}</result>
     </action>
     <action name="*/*" 
            class="adri.logviewer.action.CrudAction" 
            method="find">
         <interceptor-ref name="loginStack"/>
         <param name="classe">adri.logviewer.model.{1}View</param>
         <param name="item.id">{2}</param>
         <result name="success">/{1}/details.jsp</result>
         <result name="error" type="redirectAction">{1}</result>
         <result name="input" type="redirectAction">{1}</result>
     </action>
     <action name="*/search" 
            class="adri.logviewer.action.CrudAction" 
            method="search">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}View</param>
         <result name="success">/{1}/list.jsp</result>
         <result name="error" type="redirectAction">{1}</result>
     </action>
     
     <!-- ************************
     	**********MesInfos***********
      **************************** -->
      
     <action name="MesInformations" 
            class="adri.logviewer.action.UtilisateurAction" 
            method="start">
         <result name="success">/MesInformations/details.jsp</result>
         <result name="error">login.jsp</result>
     </action>
     <action name="MesInformations/edit/" 
            class="adri.logviewer.action.BaseAction" 
            method="start">
         <result name="success">/MesInformations/edit.jsp</result>
         <result name="error" type="redirectAction">MesInformations</result>
     </action>
     <action name="MesInformations/update" 
            class="adri.logviewer.action.UtilisateurAction" 
            method="update">
         <interceptor-ref name="loginStack"/>
         <result name="success" type="redirectAction">MesInformations</result>
         <result name="error">/MesInformations/edit.jsp</result>
         <result name="none" type="redirectAction">MesInformations</result>
     </action>
     
     <!-- ************************
     	**********Fichier***********
      **************************** -->
      
      
     <action name="Fichier" 
            class="adri.logviewer.action.FileAction" 
            method="start">
         <interceptor-ref name="fileStack"/>
         <result name="success">/Fichiers/index.jsp</result>
         <result name="none">/Fichiers/index.jsp</result>
         <result name="error">index</result>
     </action>
     <action name="Fichier/download" 
     		class="adri.logviewer.action.FileAction" 
     		method="download">
         <interceptor-ref name="fileStack"/>
		<result name="success" type="stream">
		  <param name="contentLength">${fileLength}</param>
		  <param name="contentType">application/octet-stream</param>
		  <param name="inputName">fileInputStream</param>
		  <param name="contentDisposition">attachment;filename="${file}"</param>
		  <param name="bufferSize">1024</param>
		</result>
        <result name="none">/Fichiers/index.jsp</result>
        <result name="error" type="redirectAction">index</result>
	  </action>
     
     <!-- ************************
     	**********Agent connexion***********
      **************************** -->
      
     <action name="Agent/*/connect" 
            class="adri.logviewer.action.FileAction" 
            method="connexion">
         <interceptor-ref name="fileStack"/>
         <param name="classe">adri.logviewer.model.AgentView</param>
         <param name="item.id">{1}</param>
         <result name="success">/Agent/connexion.jsp</result>
         <result name="none" type="redirectAction">Agent/{1}</result>
         <result name="error">/Agent/connexion.jsp</result>
     </action>
     <action name="Agent/*/open" 
            class="adri.logviewer.action.FileAction" 
            method="open">
         <interceptor-ref name="fileStack"/>
         <param name="classe">adri.logviewer.model.AgentView</param>
         <param name="item.id">{1}</param>
         <result name="success">/Agent/File.jsp</result>
         <result name="none" type="redirectAction">Agent/{1}</result>
         <result name="error">/Agent/connexion.jsp</result>
     </action>
     <action name="Agent/*/parse" 
            class="adri.logviewer.action.FileAction" 
            method="open">
         <interceptor-ref name="fileStack"/>
         <param name="classe">adri.logviewer.model.AgentView</param>
         <param name="item.id">{1}</param>
         <result name="success">/Agent/connexion.jsp</result>
         <result name="none" type="redirectAction">Agent/{1}</result>
         <result name="error">/Agent/connexion.jsp</result>
     </action>
     <action name="Agent/*/download" 
     		class="adri.logviewer.action.FileAction" 
     		method="download">
         <interceptor-ref name="fileStack"/>
		<result name="success" type="stream">
		  <param name="contentLength">${fileLength}</param>
		  <param name="contentType">application/octet-stream</param>
		  <param name="inputName">fileInputStream</param>
		  <param name="contentDisposition">attachment;filename="${file}"</param>
		  <param name="bufferSize">1024</param>
		</result>
        <result name="none">/Fichiers/index.jsp</result>
        <result name="error">index</result>
	  </action>
     <!-- ************************
     	**********Includes***********
      **************************** -->
      
      <action name="Includes/Loader" 
            class="adri.logviewer.action.BaseAction" 
            method="start">
         <result name="success">/includes/loader.html</result>
         <result name="error">/blank.html</result>
         <result name="login">/blank.html</result>
     </action>
     <action name="Includes/deleteConfirm/*" 
            class="adri.logviewer.action.CrudAction" 
            method="find">
         <interceptor-ref name="crudStack"/>
         <param name="classe">adri.logviewer.model.{1}</param>
         <result name="success">/includes/deleteConfirm.jsp</result>
         <result name="permission">/includes/NotAllowed_1.jsp</result>
         <result name="error">/blank.html</result>
         <result name="login">/blank.html</result>
     </action>
     <action name="Includes/detail/*/*" 
            class="adri.logviewer.action.DetailAction" 
            method="getDetails">
         <interceptor-ref name="loginStack"/>
         <param name="classe">adri.logviewer.model.{1}View</param>
         <param name="detail">adri.logviewer.model.{2}View</param>
         <result name="success">/includes/detail{2}.jsp</result>
         <result name="error">/blank.html</result>
         <result name="permission">/includes/NotAllowed_1.jsp</result>
         <result name="login">/blank.html</result>
     </action>
     
   </package>
</struts>